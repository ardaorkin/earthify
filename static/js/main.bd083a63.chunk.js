(this["webpackJsonpreact-app"]=this["webpackJsonpreact-app"]||[]).push([[0],{11:function(e,t,o){},14:function(e,t,o){},16:function(e,t,o){"use strict";o.r(t);var n=o(0),a=o.n(n),c=o(5),r=o.n(c),i=(o(11),o(2)),s=o(27),l=Object(s.a)((function(e){return{paper:{minHeight:"100vh",width:"15%",backgroundColor:"black",color:"white",position:"absolute",left:"0",opacity:"0.9"}}}));function u(e){l();var t=Object(n.useState)(),o=Object(i.a)(t,2),c=o[0],r=o[1];a.a.useEffect((function(){setInterval((function(){r(JSON.parse(localStorage.getItem("playlists")))}))}));var s=function(e){fetch("https://api.spotify.com/v1/me/player/play",{method:"PUT",headers:{Authorization:"Bearer ".concat(localStorage.getItem("access_token")),"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({context_uri:e.uri})}).then((function(e){return e.json()})).then((function(e){return console.log(e)}))};return a.a.createElement(a.a.Fragment,null,c?c.map((function(e){return a.a.createElement("ul",null,a.a.createElement("li",{onClick:s(e)},e.name))})):null)}function p(e){var t=l();return a.a.createElement("div",{className:t.paper},a.a.createElement(u,e))}o(14);var h=function(e){var t,n=localStorage.getItem("access_token")||"",c=a.a.useState(n),r=Object(i.a)(c,2),s=r[0],l=r[1],u=a.a.useState(window.localStorage.getItem("auth")),h=Object(i.a)(u,2),f=h[0],d=(h[1],a.a.useState(localStorage.getItem("refresh_token"))),m=Object(i.a)(d,2),y=m[0],g=m[1],w="9e71a4da3ee24d31ab4fd842607cce9e";t="http://localhost:3000"!==window.location.origin?window.location.origin+window.location.pathname:window.location.origin+"/callback";var _=o(15);return _.accessToken="pk.eyJ1IjoiYXJkYW9ya2luIiwiYSI6ImNrOW9teW8wMzAyNnczbHJ0emVvNHE5dXcifQ.J_P9VwfH6UeYpgG5gw-JJQ",null!==window.location.search.match(/\?code/g)&&fetch("https://accounts.spotify.com/api/token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"},body:"grant_type=authorization_code&code=".concat(window.location.search.split("=")[1],"&redirect_uri=").concat(t,"&client_id=").concat(w,"&client_secret=").concat("907e432cd3d74554b29582eb58756277")}).then((function(e){return e.json()})).then((function(e){localStorage.setItem("create_access_token_result",JSON.stringify(e)),localStorage.setItem("access_token",e.access_token),localStorage.setItem("refresh_token",e.refresh_token)})).then((function(){l(localStorage.getItem("access_token")),g(localStorage.getItem("refresh_token"))})).then((function(){return window.location=window.location.origin+"/earthify"})).then((function(){return window.localStorage.setItem("auth",!0)})).catch((function(e){return console.log("acees_token_respone: ",e)})),a.a.useEffect((function(){new _.Map({container:"root",style:"mapbox://styles/mapbox/light-v10",zoom:3}).on("click",(function(e){if(window.location.search.match(/\?code/g)||f){function o(){fetch("https://api.mapbox.com/geocoding/v5/mapbox.places/".concat(e.lngLat.lng.toString(),",").concat(e.lngLat.lat.toString(),".json?&access_token=").concat(_.accessToken),{method:"GET",headers:{"Content-Type":"application/json"}}).then((function(e){return e.json()})).then((function(e){e.features.map((function(e){return"country"===e.place_type[0]&&(console.log("map_results: ",e),fetch("https://api.spotify.com/v1/search?q=".concat(encodeURIComponent("".concat(e.text," top 50")),"&type=playlist"),{method:"GET",headers:{Authorization:"Bearer ".concat(s)}}).then((function(e){return e.json()})).then((function(t){t.error&&401===t.error.status&&n(),console.log("search_results: ",t);var o=[],a=[];if(t.playlists.items.map((function(e){("Top 50 Playlists"===e.owner.display_name||"spotifycharts"===e.owner.display_name||e.name.match(/top\ 50/gi))&&o.push(e)})),a=o.length>1?o[0]:o,Object.keys(a).length>0)localStorage.setItem("playlists",JSON.stringify(o)),console.log("top_fifth_playlists: ",a),fetch("https://api.spotify.com/v1/me/player/devices",{method:"GET",headers:{Authorization:"Bearer "+s}}).then((function(e){return e.json()})).then((function(e){e.error&&401===e.error.status&&n(),console.log("all_devices_result: ",e),0===e.devices.length&&alert("Please run Spotify App in your device.");var t=[];e.devices.map((function(e){return!0===e.is_active&&t.push(e.id),t})),console.log("active_devices_array: ",t),t.length>0?(console.log("active device found!"),fetch("https://api.spotify.com/v1/me/player/play?",{method:"PUT",headers:{Authorization:"Bearer ".concat(s),"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({context_uri:a.uri})}).then((function(e){return e.json()})).then((function(e){e.error&&401===e.error.status&&n(),console.log("player_result: ",e)})).catch((function(e){return console.log("player_err: ",e)}))):0===t.length&&(console.log("there is no active device. first found device is activating..."),fetch("https://api.spotify.com/v1/me/player",{method:"PUT",headers:{Authorization:"Bearer "+s,"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({device_ids:[t[0]],play:!0})}).then((function(e){return e.json()})).then((function(e){e.error&&401===e.error.status?n():e.error&&404===e.error.status&&alert("Please run Spotify App in your device."),console.log("activate_device_result: ",e)})))})).catch((function(e){return console.log("device_err: ",e)}));else if(0===Object.keys(a).length){var c;if(console.log("there is no top 50 playlist for this country"),window.confirm("There is any Top 50 playlist for ".concat(e.text,"\nDo you wanna create one?")))c=!!window.confirm("Do you wanna make it public?"),fetch("https://api.spotify.com/v1/me",{method:"GET",headers:{Authorization:"Bearer "+s}}).then((function(e){return e.json()})).then((function(t){console.log("current_user_info: ",t),fetch("https://api.spotify.com/v1/users/".concat(t.id,"/playlists"),{method:"POST",headers:{Authorization:"Bearer "+s,"Content-Type":"application/json"},body:JSON.stringify({name:"".concat(e.text," Top 50"),public:c,description:"Created via Earthify"})}).then((function(e){return e.json()})).then((function(t){console.log("create_playlist_result: ",t),alert("Congratulaitons! You've just create a playlist name ".concat(e.text," Top 50\nYou playlists' Spotify URI is ").concat(t.uri,"\nLet's add some track.\nMay the followers be with you! ;)"))}))}))}return a})).catch((function(e){return console.log("search_err: ",e)}))),e}))})).catch((function(e){console.log("map_err: ",e)}))}function n(){console.log("access token is refreshing..."),fetch("https://accounts.spotify.com/api/token",{method:"POST",headers:{Authorization:"Basic OWU3MWE0ZGEzZWUyNGQzMWFiNGZkODQyNjA3Y2NlOWU6ZjJhZjc4MjVhOTA1NGNiNWE5MmMwZDZlMWEwNDAwNTY=","Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"},body:"grant_type=refresh_token&refresh_token=".concat(y)}).then((function(e){return e.json()})).then((function(e){console.log("updating access token..."),localStorage.setItem("access_token",e.access_token)})).then((function(){return console.log("acess token were refresh\nnew access token: ",localStorage.getItem("access_token"))})).then((function(){return o()})).then((function(){return window.location.reload()}))}console.log("acces_token: ",s),o()}else window.location="https://accounts.spotify.com/authorize?client_id=".concat(w,"&response_type=code&redirect_uri=").concat(encodeURIComponent(t),"&scope=").concat(encodeURIComponent("user-read-private user-read-email user-modify-playback-state user-read-playback-state playlist-modify-public playlist-modify-private"),"&show_dialog=true")}))}),[]),a.a.createElement(a.a.Fragment,null,a.a.createElement(p,null),a.a.createElement("div",{id:"map",className:"App"}))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(a.a.createElement(a.a.StrictMode,null,a.a.createElement(h,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},6:function(e,t,o){e.exports=o(16)}},[[6,1,2]]]);
//# sourceMappingURL=main.bd083a63.chunk.js.map