(this["webpackJsonpreact-app"]=this["webpackJsonpreact-app"]||[]).push([[0],{11:function(e,t,o){},13:function(e,t,o){},15:function(e,t,o){"use strict";o.r(t);var n=o(0),c=o.n(n),a=o(4),i=o.n(a),r=(o(11),o(2)),s=o.n(r),l=o(5),u=o(1);o(13);var p=function(e){var t,n=c.a.useState(localStorage.getItem("access_token")),a=Object(u.a)(n,2),i=a[0],r=a[1],p=c.a.useState(window.localStorage.getItem("auth")),h=Object(u.a)(p,2),d=h[0],f=(h[1],c.a.useState(localStorage.getItem("refresh_token"))),m=Object(u.a)(f,2),g=m[0],y=m[1],w=c.a.useState(!0),_=Object(u.a)(w,2),v=(_[0],_[1],{});t="http://localhost:3000"!==window.location.origin?window.location.origin+window.location.pathname:window.location.origin+"/callback";var k=o(14);if(k.accessToken="pk.eyJ1IjoiYXJkYW9ya2luIiwiYSI6ImNrOW9teW8wMzAyNnczbHJ0emVvNHE5dXcifQ.J_P9VwfH6UeYpgG5gw-JJQ",null!==window.location.search.match(/\?code/g)){function j(){return(j=Object(l.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,window.localStorage.setItem("auth",!0);case 2:return e.next=4,fetch("https://accounts.spotify.com/api/token",{method:"POST",headers:{Authorization:"Basic OWU3MWE0ZGEzZWUyNGQzMWFiNGZkODQyNjA3Y2NlOWU6ZjJhZjc4MjVhOTA1NGNiNWE5MmMwZDZlMWEwNDAwNTY=","Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"},body:"grant_type=authorization_code&code=".concat(window.location.search.split("=")[1],"&redirect_uri=").concat(t)}).then((function(e){return e.json()})).then((function(e){localStorage.setItem("access_token",e.access_token),localStorage.setItem("refresh_token",e.refresh_token)})).then((function(){r(localStorage.getItem("access_token")),y(localStorage.getItem("refresh_token"))})).then((function(){return window.location=window.location.origin+"/earthify"})).catch((function(e){return console.log("acees_token_respone: ",e)}));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){j.apply(this,arguments)}()}return c.a.useEffect((function(){new k.Map({container:"root",style:"mapbox://styles/mapbox/light-v10",zoom:3}).on("click",(function(e){window.location.search.match(/\?code/g)||d?(console.log("acces_token: ",i),fetch("https://api.mapbox.com/geocoding/v5/mapbox.places/".concat(e.lngLat.lng.toString(),",").concat(e.lngLat.lat.toString(),".json?&access_token=").concat(k.accessToken),{method:"GET",headers:{"Content-Type":"application/json"}}).then((function(e){return e.json()})).then((function(e){e.features.map((function(e){return"country"===e.place_type[0]&&fetch("https://api.spotify.com/v1/search?q=".concat(encodeURIComponent("".concat(e.text," top 50")),"&type=playlist"),{method:"GET",headers:{Authorization:"Bearer ".concat(i)}}).then((function(e){return e.json()})).then((function(e){console.log("search_results: ",e),v.search_results=e,e.playlists.items.map((function(e){return"Top 50 Playlists"===e.owner.display_name&&(console.log("top_fifth_playlists: ",e.uri),fetch("https://api.spotify.com/v1/me/player/devices",{method:"GET",headers:{Authorization:"Bearer "+i}}).then((function(e){return e.json()})).then((function(t){console.log("devices_result: ",t),v.devices_results=t;var o=[];t.devices.map((function(e){return!0===e.is_active&&o.push(e.id),o})),console.log("devices_array: ",o),o.length>0?(console.log("active device found!"),fetch("https://api.spotify.com/v1/me/player/play?",{method:"PUT",headers:{Authorization:"Bearer ".concat(i),"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({context_uri:e.uri})}).then((function(e){return e.json()})).then((function(e){console.log("player_result: ",e),v.playes_result=e})).catch((function(e){return console.log("player_err: ",e)}))):0===o.length&&(console.log("there is no active device. first found device is activating..."),fetch("https://api.spotify.com/v1/me/player",{method:"PUT",headers:{Authorization:"Bearer "+i,"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({device_ids:[o[0]],play:!0})}).then((function(e){return e.json()})).then((function(e){console.log("activate_device_result: ",e),v.activate_device_result=e})))})).catch((function(e){return console.log("device_err: ",e)}))),e}))})).catch((function(e){return console.log("search_err: ",e)})),e}))})).catch((function(e){console.log("map_err: ",e)}))):window.location="https://accounts.spotify.com/authorize?client_id=".concat("9e71a4da3ee24d31ab4fd842607cce9e","&response_type=code&redirect_uri=").concat(encodeURIComponent(t),"&scope=").concat(encodeURIComponent("user-modify-playback-state user-read-playback-state"),"&show_dialog=true")}));var e=setInterval((function(){Object.values(v).map((function(e){console.log("final_results: ",e),e.error?401===e.error.status?(console.log("acces token is invalid at level: ",e),fetch("https://accounts.spotify.com/api/token",{method:"POST",headers:{Authorization:"Basic OWU3MWE0ZGEzZWUyNGQzMWFiNGZkODQyNjA3Y2NlOWU6ZjJhZjc4MjVhOTA1NGNiNWE5MmMwZDZlMWEwNDAwNTY=","Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"},body:"grant_type=refresh_token&refresh_token=".concat(g)}).then((function(e){return e.json()})).then((function(e){return localStorage.setItem("access_token",e.access_token)})).then((function(){return v={}}))):404===e.error.status&&window.confirm("Plase run Spotify App in your device")&&(v={}):v={}}))}),500);return function(){clearInterval(e),v={}}}),[]),c.a.createElement(c.a.Fragment,null,c.a.createElement("div",{id:"map",className:"App"}))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(c.a.createElement(c.a.StrictMode,null,c.a.createElement(p,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},6:function(e,t,o){e.exports=o(15)}},[[6,1,2]]]);
//# sourceMappingURL=main.252ec95f.chunk.js.map